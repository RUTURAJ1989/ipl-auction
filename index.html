<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPL Auction Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .logo-preview {
            max-width: 100px;
            max-height: 100px;
            margin-top: 10px;
        }
        .nav-pills .nav-link.active {
            background-color: #0d6efd;
        }
        .csv-upload {
            border: 2px dashed #ccc;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 bg-dark text-white min-vh-100">
                <div class="p-3">
                    <h3 class="text-center mb-4">üèè IPL Auction</h3>
                    <ul class="nav nav-pills flex-column">
                        <li class="nav-item">
                            <a class="nav-link text-white active" href="#teams" data-bs-toggle="pill">
                                <i class="fas fa-users me-2"></i> Teams
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-white" href="#players" data-bs-toggle="pill">
                                <i class="fas fa-user me-2"></i> Players
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-white" href="#bulk-upload" data-bs-toggle="pill">
                                <i class="fas fa-file-csv me-2"></i> Bulk Upload
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 p-4">
                <h2 class="mb-4">Admin Dashboard</h2>
                
                <div class="tab-content">
                    <!-- Teams Tab -->
                    <div class="tab-pane fade show active" id="teams">
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h4 class="mb-0">Add New Team</h4>
                            </div>
                            <div class="card-body">
                                <form id="teamForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Team Name</label>
                                                <input type="text" class="form-control" id="teamName" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Short Code (e.g., RCB)</label>
                                                <input type="text" class="form-control" id="teamCode" maxlength="3" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Total Budget (in Crores)</label>
                                                <input type="number" class="form-control" id="teamBudget" min="50" max="100" value="80" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Team Logo</label>
                                                <input type="file" class="form-control" id="teamLogo" accept="image/*">
                                                <div class="mt-2">
                                                    <img id="logoPreview" src="https://via.placeholder.com/100" class="logo-preview">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i>Save Team
                                    </button>
                                </form>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h4 class="mb-0">Team List</h4>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Logo</th>
                                                <th>Team</th>
                                                <th>Code</th>
                                                <th>Budget</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="teamList">
                                            <!-- Teams will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Players Tab -->
                    <div class="tab-pane fade" id="players">
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h4 class="mb-0">Add New Player</h4>
                            </div>
                            <div class="card-body">
                                <form id="playerForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Player Name</label>
                                                <input type="text" class="form-control" id="playerName" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Role</label>
                                                <select class="form-select" id="playerRole" required>
                                                    <option value="batsman">Batsman</option>
                                                    <option value="bowler">Bowler</option>
                                                    <option value="all-rounder">All-Rounder</option>
                                                    <option value="wicketkeeper">Wicketkeeper</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Base Price (in Crores)</label>
                                                <input type="number" class="form-control" id="playerPrice" min="0.2" max="10" step="0.1" value="1" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Country</label>
                                                <input type="text" class="form-control" id="playerCountry" value="India">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Player Image</label>
                                                <input type="file" class="form-control" id="playerImage" accept="image/*">
                                                <div class="mt-2">
                                                    <img id="playerImagePreview" src="https://via.placeholder.com/100" class="logo-preview">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i>Save Player
                                    </button>
                                </form>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h4 class="mb-0">Player List</h4>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Image</th>
                                                <th>Name</th>
                                                <th>Role</th>
                                                <th>Price</th>
                                                <th>Country</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="playerTableBody">
                                            <!-- Players will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bulk Upload Tab -->
                    <div class="tab-pane fade" id="bulk-upload">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header bg-info text-white">
                                        <h4 class="mb-0">Bulk Upload Teams</h4>
                                    </div>
                                    <div class="card-body">
                                        <div class="csv-upload">
                                            <i class="fas fa-file-csv fa-3x mb-3"></i>
                                            <h5>Upload Teams CSV</h5>
                                            <p class="text-muted">Format: Name, Code, Budget, LogoURL</p>
                                            <input type="file" id="teamsCsv" accept=".csv" class="form-control">
                                            <button id="uploadTeamsBtn" class="btn btn-info mt-3">
                                                <i class="fas fa-upload me-2"></i>Upload Teams
                                            </button>
                                        </div>
                                        <a href="sample_teams.csv" download class="btn btn-outline-info">
                                            <i class="fas fa-download me-2"></i>Download Sample CSV
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header bg-info text-white">
                                        <h4 class="mb-0">Bulk Upload Players</h4>
                                    </div>
                                    <div class="card-body">
                                        <div class="csv-upload">
                                            <i class="fas fa-file-csv fa-3x mb-3"></i>
                                            <h5>Upload Players CSV</h5>
                                            <p class="text-muted">Format: Name, Role, Price, Country, ImageURL</p>
                                            <input type="file" id="playersCsv" accept=".csv" class="form-control">
                                            <button id="uploadPlayersBtn" class="btn btn-info mt-3">
                                                <i class="fas fa-upload me-2"></i>Upload Players
                                            </button>
                                        </div>
                                        <a href="sample_players.csv" download class="btn btn-outline-info">
                                            <i class="fas fa-download me-2"></i>Download Sample CSV
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase & Other JS -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCdimEpxhfYQkmaJuWUjhegu227c-rhfY0",
            authDomain: "ipl-auction-f62cf.firebaseapp.com",
            projectId: "ipl-auction-f62cf",
            storageBucket: "ipl-auction-f62cf.firebasestorage.app",
            messagingSenderId: "1006195476972",
            appId: "1:1006195476972:web:6343541fb0007925ded8c9"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // DOM Elements
        const teamForm = document.getElementById('teamForm');
        const playerForm = document.getElementById('playerForm');
        const teamList = document.getElementById('teamList');
        const playerTableBody = document.getElementById('playerTableBody');
        const logoPreview = document.getElementById('logoPreview');
        const playerImagePreview = document.getElementById('playerImagePreview');
        const teamsCsv = document.getElementById('teamsCsv');
        const playersCsv = document.getElementById('playersCsv');
        const uploadTeamsBtn = document.getElementById('uploadTeamsBtn');
        const uploadPlayersBtn = document.getElementById('uploadPlayersBtn');

        // Image Preview Handlers
        document.getElementById('teamLogo').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    logoPreview.src = event.target.result;
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        document.getElementById('playerImage').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    playerImagePreview.src = event.target.result;
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        // Add Team
        teamForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('teamName').value;
            const code = document.getElementById('teamCode').value;
            const budget = document.getElementById('teamBudget').value;
            const logoFile = document.getElementById('teamLogo').files[0];
            
            try {
                let logoUrl = 'https://via.placeholder.com/100';
                
                // Upload logo if selected
                if (logoFile) {
                    const storageRef = storage.ref(`team_logos/${code}_${Date.now()}`);
                    const snapshot = await storageRef.put(logoFile);
                    logoUrl = await snapshot.ref.getDownloadURL();
                }
                
                // Add team to Firestore
                await db.collection('teams').add({
                    name,
                    code,
                    budget: parseFloat(budget),
                    logoUrl,
                    remainingBudget: parseFloat(budget),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                alert('Team added successfully!');
                teamForm.reset();
                logoPreview.src = 'https://via.placeholder.com/100';
                loadTeams();
            } catch (error) {
                console.error('Error adding team:', error);
                alert('Error adding team. Please try again.');
            }
        });

        // Add Player
        playerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('playerName').value;
            const role = document.getElementById('playerRole').value;
            const price = document.getElementById('playerPrice').value;
            const country = document.getElementById('playerCountry').value;
            const imageFile = document.getElementById('playerImage').files[0];
            
            try {
                let imageUrl = 'https://via.placeholder.com/100';
                
                // Upload image if selected
                if (imageFile) {
                    const storageRef = storage.ref(`player_images/${name.replace(/\s+/g, '_')}_${Date.now()}`);
                    const snapshot = await storageRef.put(imageFile);
                    imageUrl = await snapshot.ref.getDownloadURL();
                }
                
                // Add player to Firestore
                await db.collection('players').add({
                    name,
                    role,
                    price: parseFloat(price),
                    country,
                    imageUrl,
                    status: 'unsold',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                alert('Player added successfully!');
                playerForm.reset();
                playerImagePreview.src = 'https://via.placeholder.com/100';
                loadPlayers();
            } catch (error) {
                console.error('Error adding player:', error);
                alert('Error adding player. Please try again.');
            }
        });

        // Load Teams
        async function loadTeams() {
            try {
                const snapshot = await db.collection('teams')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                teamList.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const team = doc.data();
                    teamList.innerHTML += `
                        <tr>
                            <td><img src="${team.logoUrl}" width="40" height="40"></td>
                            <td>${team.name}</td>
                            <td>${team.code}</td>
                            <td>‚Çπ${team.budget} Cr</td>
                            <td>
                                <button class="btn btn-sm btn-warning me-2">Edit</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteTeam('${doc.id}')">Delete</button>
                            </td>
                        </tr>
                    `;
                });
            } catch (error) {
                console.error('Error loading teams:', error);
            }
        }

        // Load Players
        async function loadPlayers() {
            try {
                const snapshot = await db.collection('players')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                playerTableBody.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const player = doc.data();
                    playerTableBody.innerHTML += `
                        <tr>
                            <td><img src="${player.imageUrl}" width="40" height="40"></td>
                            <td>${player.name}</td>
                            <td>${player.role}</td>
                            <td>‚Çπ${player.price} Cr</td>
                            <td>${player.country}</td>
                            <td>
                                <button class="btn btn-sm btn-warning me-2">Edit</button>
                                <button class="btn btn-sm btn-danger" onclick="deletePlayer('${doc.id}')">Delete</button>
                            </td>
                        </tr>
                    `;
                });
            } catch (error) {
                console.error('Error loading players:', error);
            }
        }

        // Delete Team
        async function deleteTeam(teamId) {
            if (confirm('Are you sure you want to delete this team?')) {
                try {
                    await db.collection('teams').doc(teamId).delete();
                    loadTeams();
                } catch (error) {
                    console.error('Error deleting team:', error);
                    alert('Error deleting team. Please try again.');
                }
            }
        }

        // Delete Player
        async function deletePlayer(playerId) {
            if (confirm('Are you sure you want to delete this player?')) {
                try {
                    await db.collection('players').doc(playerId).delete();
                    loadPlayers();
                } catch (error) {
                    console.error('Error deleting player:', error);
                    alert('Error deleting player. Please try again.');
                }
            }
        }

        // Bulk Upload Teams
        uploadTeamsBtn.addEventListener('click', async () => {
            if (!teamsCsv.files[0]) {
                alert('Please select a CSV file first');
                return;
            }

            try {
                const file = teamsCsv.files[0];
                const text = await file.text();
                const results = Papa.parse(text, { header: true });
                
                let successCount = 0;
                let errorCount = 0;
                
                for (const row of results.data) {
                    try {
                        await db.collection('teams').add({
                            name: row.Name,
                            code: row.Code,
                            budget: parseFloat(row.Budget),
                            logoUrl: row.LogoURL,
                            remainingBudget: parseFloat(row.Budget),
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        successCount++;
                    } catch (error) {
                        console.error(`Error adding team ${row.Name}:`, error);
                        errorCount++;
                    }
                }
                
                alert(`Bulk upload complete!\nSuccess: ${successCount}\nErrors: ${errorCount}`);
                teamsCsv.value = '';
                loadTeams();
            } catch (error) {
                console.error('Error processing teams CSV:', error);
                alert('Error processing CSV file. Please check the format.');
            }
        });

        // Bulk Upload Players
        uploadPlayersBtn.addEventListener('click', async () => {
            if (!playersCsv.files[0]) {
                alert('Please select a CSV file first');
                return;
            }

            try {
                const file = playersCsv.files[0];
                const text = await file.text();
                const results = Papa.parse(text, { header: true });
                
                let successCount = 0;
                let errorCount = 0;
                
                for (const row of results.data) {
                    try {
                        await db.collection('players').add({
                            name: row.Name,
                            role: row.Role,
                            price: parseFloat(row.Price),
                            country: row.Country,
                            imageUrl: row.ImageURL,
                            status: 'unsold',
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        successCount++;
                    } catch (error) {
                        console.error(`Error adding player ${row.Name}:`, error);
                        errorCount++;
                    }
                }
                
                alert(`Bulk upload complete!\nSuccess: ${successCount}\nErrors: ${errorCount}`);
                playersCsv.value = '';
                loadPlayers();
            } catch (error) {
                console.error('Error processing players CSV:', error);
                alert('Error processing CSV file. Please check the format.');
            }
        });

        // Initialize
        loadTeams();
        loadPlayers();
    </script>
</body>
</html>